apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-telegram-config
  namespace: monitoring
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m
    templates:
      - '*.tmpl'
    route:
      group_by: ['alertname']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'telegram-receiver'
    receivers:
      - name: 'telegram-receiver'
        telegram_configs:
          - bot_token: '5860768058:AAGXJfS7jx5RZOg5oo-2yNbUPOXEpN3291I'
            chat_id: 1470038286
            api_url: 'https://api.telegram.org'
            parse_mode: 'HTML'
            message: '{{ template "telegram.vvisveswaran.message" . }}'

  vvisveswaran.tmpl: |
    {{ define "__vvisveswaran_text_alert_list" }}{{ range . }}
    ğŸªª <b>{{ .Labels.alertname }}</b>
    {{- if .Annotations.summary }}
    ğŸ“ {{ .Annotations.summary }}{{ end }}
    ğŸ· Labels:
    {{ range .Labels.SortedPairs }}  <i>{{ .Name }}</i>: <code>{{ .Value }}</code>
    {{ end }}{{ end }}
    {{ end }}
    {{ define "telegram.vvisveswaran.message" }}
    {{ if gt (len .Alerts.Firing) 0 }}
    ğŸ”¥ Alerts Firing ğŸ”¥
    {{ template "__vvisveswaran_text_alert_list" .Alerts.Firing }}
    {{ end }}
    {{ if gt (len .Alerts.Resolved) 0 }}
    âœ… Alerts Resolved âœ…
    {{ template "__vvisveswaran_text_alert_list" .Alerts.Resolved }}
    {{ end }}
    {{ end }}
